

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Decision trees &mdash; CoRoT Contributions</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="CoRoTContributions" href="modules.html" />
    <link rel="prev" title="XGBoost Classifier" href="03 - Machine Learning - XGBoost Classifier.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Contributions
          

          
            
            <img src="_static/corot_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Reading and Plotting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="01 - Reading and Plotting.html">Read <em>.fits</em> raw data</a></li>
<li class="toctree-l1"><a class="reference internal" href="01 - Reading and Plotting.html#Preprocessing-data">Preprocessing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="01 - Reading and Plotting.html#Resampling-series">Resampling series</a></li>
<li class="toctree-l1"><a class="reference internal" href="01 - Reading and Plotting.html#Filtering-series">Filtering series</a></li>
<li class="toctree-l1"><a class="reference internal" href="01 - Reading and Plotting.html#Application-example">Application example</a></li>
<li class="toctree-l1"><a class="reference internal" href="01 - Reading and Plotting.html#Generation-algorithms">Generation algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="01 - Reading and Plotting.html#Save-pre-processed-data">Save pre-processed data</a></li>
</ul>
<p class="caption"><span class="caption-text">Feature Engineering</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="02 - Building and creating features.html">Reading the data</a></li>
<li class="toctree-l1"><a class="reference internal" href="02 - Building and creating features.html#Feature:-Frequency-response">Feature: Frequency response</a></li>
<li class="toctree-l1"><a class="reference internal" href="02 - Building and creating features.html#Feature:-Naive-Bayes-likelihood">Feature: Naive Bayes likelihood</a></li>
<li class="toctree-l1"><a class="reference internal" href="02 - Building and creating features.html#Feature:-Markov-Hidden-Models">Feature: Markov Hidden Models</a></li>
</ul>
<p class="caption"><span class="caption-text">Machine Learning</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="03 - Machine Learning - XGBoost Classifier.html">XGBoost Classifier</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Decision trees</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Periodograms">Periodograms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Manipulate-features">Manipulate features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Train-test-data-split">Train-test data split</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Hyper-tunning">Hyper tunning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Train-model">Train model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Results">Results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Comments">Comments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Naive-Bayes-likelihood">Naive Bayes likelihood</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Manipulate features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Train-test data split</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Hyper tunning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Train model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Comments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Hidden-Markov-Models">Hidden Markov Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">Manipulate features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Train-test data split</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Hyper tunning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Train model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id12">Comments</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">CoRoTContributions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Contributions</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Decision trees</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/03 - Machine Learning - Decision Trees.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Decision-trees">
<h1>Decision trees<a class="headerlink" href="#Decision-trees" title="Permalink to this headline">¶</a></h1>
<p>The approach presented in this path, will be one that uses the classical Decision Trees to manage the classification problem. Most of the steps presented here will repeat itself from the XGBoost path, but the algorithm analysis will be a little bit different. This shows that by following the procedure proposed in this study, in general, leads to an interesting pipeline that enables the user to run several machine learning algorithms from the same rundown. Also, this algorithm will be used for
each generated feature, namelly:</p>
<ul class="simple">
<li><p>Periodograms</p></li>
<li><p>Bayes Similarity</p></li>
<li><p>Hidden Markov Models</p></li>
</ul>
<p>All approaches will pass trough the common machine learning pipeline, where we must:</p>
<ul class="simple">
<li><p>Normalize the data (if necessary)</p></li>
<li><p>Divide the data between trainning and testing</p></li>
<li><p>Search the hyper parameters</p></li>
<li><p>Cross validate the models</p></li>
<li><p>Analyse the results</p></li>
</ul>
<div class="section" id="Periodograms">
<h2>Periodograms<a class="headerlink" href="#Periodograms" title="Permalink to this headline">¶</a></h2>
<p>The application using the periodograms is actually pretty simple, now that the data is prepared and all of those preprocessing from last pipeline step is already done. The algorithm became straigh forward. First it is necessary to read the features generated.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;./features/freq_data/freq_data.pkl&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">freq_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">freq_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;features&#39;, &#39;labels&#39;])
</pre></div></div>
</div>
<div class="section" id="Manipulate-features">
<h3>Manipulate features<a class="headerlink" href="#Manipulate-features" title="Permalink to this headline">¶</a></h3>
<p>After reading the data, it is necessary to create the classical regression structure model in the format <span class="math notranslate nohighlight">\(Y = f\left(\Theta, X\right)\)</span>, normalize the feature data and encode any possible label data into numerical classes. This is just the preparation for the machine leaning algorithm to guarantee that the provided info is properlly designed for any machine learning classical form.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>

<span class="c1"># Create the label encoder</span>
<span class="n">le_freq</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">le_freq</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">freq_data</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">])</span>

<span class="c1"># Define the regression model</span>
<span class="n">regressors</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">freq_data</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="s1">&#39;spec&#39;</span><span class="p">])</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">le_freq</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">freq_data</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">regressors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
12758
</pre></div></div>
</div>
<p>Also it is interesting to reduce the features dimension to build a simpler model. It is not necessary to create a classifier with such amount (12758 features…) of features. There are several techniques that can be used to reduce the features dimensions. The Principal Component Analisys, is very effective when dealing with high dimensional data. Here the <code class="docutils literal notranslate"><span class="pre">PCA</span></code> algorithm from the <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> library is used.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="c1"># Create the PCA decomposer</span>
<span class="n">pca_dec</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span><span class="c1">#, svd_solver=&#39;arpack&#39;)</span>

<span class="c1"># Train the PCA object</span>
<span class="n">pca_dec</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">regressors</span><span class="p">)</span>

<span class="c1"># Transform the data using</span>
<span class="c1"># the PCA model</span>
<span class="n">pca_regressor</span> <span class="o">=</span> <span class="n">pca_dec</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">regressors</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Train-test-data-split">
<h3>Train-test data split<a class="headerlink" href="#Train-test-data-split" title="Permalink to this headline">¶</a></h3>
<p>Next it is necessary to segregate the data into a set for validation and one for trainning the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">pca_regressor</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Hyper-tunning">
<h3>Hyper tunning<a class="headerlink" href="#Hyper-tunning" title="Permalink to this headline">¶</a></h3>
<p>We could consider tunning the model hyper parameters to answer questions such as:</p>
<ul class="simple">
<li><p>Wich value of <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> is the best for this model and data?</p></li>
<li><p>Wich cost function is the best to be selected as <code class="docutils literal notranslate"><span class="pre">criterion</span></code> for this model?</p></li>
</ul>
<p>We could do a hyper search, to find the best hyper parameters for this model, automating the hyper parameter selection. There are several already builded algorithms to optimize this parameter search, and build find with high performance the best parameters, provided a set of possible values. But, to understand what those algorithms actually does, we could once build our own search algorithm…</p>
<p>As an example, lets run a first handly defined hyper parameter tunning using the confusion matrix of the model:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="c1"># Define the model parameters</span>
<span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;random_state&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;criterion&#39;</span> <span class="p">:</span> <span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="c1"># or &#39;entropy&#39; for information gain</span>
    <span class="s1">&#39;max_depth&#39;</span> <span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="c1"># Create the range parameters to</span>
<span class="c1"># search</span>
<span class="n">max_features_dim</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">max_depth</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_features_dim</span><span class="p">)]</span>

<span class="c1"># Create the plotting variable</span>
<span class="n">plot_vals</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;confirmed targets&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">},</span>
    <span class="s1">&#39;false&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;confirmed targets&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Estimate and validate each candidate</span>
<span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">max_depth</span><span class="p">:</span>
    <span class="c1"># Update the model parameters</span>
    <span class="n">param_dist</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt</span>
    <span class="c1"># Create the xgBoost classifier</span>
    <span class="n">clfs</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param_dist</span><span class="p">)</span>
    <span class="c1"># Fit the model to the data</span>
    <span class="n">clfs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1"># Estimate the test output</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">clfs</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="c1"># Compute the confusion matrix</span>
    <span class="n">conf_mat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span>
        <span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
    <span class="c1"># Save the confusion matrix</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Line plot each confidence matrix parameter</span>
<span class="n">x_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">]</span>
<span class="n">y_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">],</span>
          <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">],</span>
          <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">],</span>
          <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">]]</span>
<span class="n">legends</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;True - C.T.&#39;</span><span class="p">,</span> <span class="s1">&#39;True - E.B.&#39;</span><span class="p">,</span> <span class="s1">&#39;False - C.T.&#39;</span><span class="p">,</span> <span class="s1">&#39;False - E.B.&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">visual</span><span class="o">.</span><span class="n">multline_plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span>
                         <span class="n">legend_label</span><span class="o">=</span><span class="n">legends</span><span class="p">,</span>
                         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Hyper parameter search - Confusion parameters plot&#39;</span><span class="p">,</span>
                         <span class="n">color_index</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                         <span class="n">y_axis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Proportion&#39;</span><span class="p">},</span>
                         <span class="n">x_axis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">})</span>
<span class="n">visual</span><span class="o">.</span><span class="n">show_plot</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div class="bk-root">
    <a href="https://bokeh.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"></a>
    <span id="1001">Loading BokehJS ...</span>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

(function(root) {
  function now() {
    return new Date();
  }

  var force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

  var JS_MIME_TYPE = 'application/javascript';
  var HTML_MIME_TYPE = 'text/html';
  var EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  var CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    var script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    var cell = handle.cell;

    var id = cell.output_area._bokeh_element_id;
    var server_id = cell.output_area._bokeh_server_id;
    // Clean up Bokeh references
    if (id != null && id in Bokeh.index) {
      Bokeh.index[id].model.document.clear();
      delete Bokeh.index[id];
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      var cmd = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd, {
        iopub: {
          output: function(msg) {
            var id = msg.content.text.trim();
            if (id in Bokeh.index) {
              Bokeh.index[id].model.document.clear();
              delete Bokeh.index[id];
            }
          }
        }
      });
      // Destroy server and session
      var cmd = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    var output_area = handle.output_area;
    var output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!output.data.hasOwnProperty(EXEC_MIME_TYPE))) {
      return
    }

    var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      var bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      var script_attrs = bk_div.children[0].attributes;
      for (var i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      var toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }


  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  var NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded() {
    var el = document.getElementById("1001");
    if (el != null) {
      el.textContent = "BokehJS is loading...";
    }
    if (root.Bokeh !== undefined) {
      if (el != null) {
        el.textContent = "BokehJS " + root.Bokeh.version + " successfully loaded.";
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(display_loaded, 100)
    }
  }


  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error() {
      console.error("failed to load " + url);
    }

    for (var i = 0; i < css_urls.length; i++) {
      var url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error;
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    const hashes = {"https://cdn.bokeh.org/bokeh/release/bokeh-2.0.1.min.js": "JpP8FXbgAZLkfur7LiK3j9AGBhHNIvF742meBJrjO2ShJDhCG2I1uVvW+0DUtrmc", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.0.1.min.js": "xZlADit0Q04ISQEdKg2k3L4W9AwQBAuDs9nJL9fM/WwzL1tEU9VPNezOFX0nLEAz", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.0.1.min.js": "4BuPRZkdMKSnj3zoxiNrQ86XgNw0rYmBOxe7nshquXwwcauupgBF2DHLVG1WuZlV", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-2.0.1.min.js": "Dv1SQ87hmDqK6S5OhBf0bCuwAEvL5QYL0PuR/F1SPVhCS/r/abjkbpKDYL2zeM19"};

    for (var i = 0; i < js_urls.length; i++) {
      var url = js_urls[i];
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      if (url in hashes) {
        element.crossOrigin = "anonymous";
        element.integrity = "sha384-" + hashes[url];
      }
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };var element = document.getElementById("1001");
  if (element == null) {
    console.error("Bokeh: ERROR: autoload.js configured with elementid '1001' but no matching script tag was found. ")
    return false;
  }

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }


  var js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-2.0.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.0.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.0.1.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-2.0.1.min.js"];
  var css_urls = [];


  var inline_js = [
    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
    function(Bokeh) {


    }
  ];

  function run_inline_js() {

    if (root.Bokeh !== undefined || force === true) {

    for (var i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }
    if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      var cell = $(document.getElementById("1001")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }

  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));
</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div class="bk-root" id="c6dbd94d-b5e2-4daf-92f4-741d8b9c3063" data-root-id="1104"></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
(function(root) {
  function embed_document(root) {

  var docs_json = {"fb2d6ddb-1655-47fe-b9ad-17989200d0e1":{"roots":{"references":[{"attributes":{"children":[{"id":"1002"}]},"id":"1104","type":"Column"},{"attributes":{"data_source":{"id":"1035"},"glyph":{"id":"1036"},"hover_glyph":null,"muted_glyph":{"id":"1038"},"nonselection_glyph":{"id":"1037"},"selection_glyph":null,"view":{"id":"1040"}},"id":"1039","type":"GlyphRenderer"},{"attributes":{"axis":{"id":"1017"},"dimension":1,"grid_line_alpha":0,"ticker":null},"id":"1020","type":"Grid"},{"attributes":{"data_source":{"id":"1064"},"glyph":{"id":"1065"},"hover_glyph":null,"muted_glyph":{"id":"1067"},"nonselection_glyph":{"id":"1066"},"selection_glyph":null,"view":{"id":"1069"}},"id":"1068","type":"GlyphRenderer"},{"attributes":{},"id":"1043","type":"BasicTickFormatter"},{"attributes":{"axis_label":"n_estimators","formatter":{"id":"1045"},"ticker":{"id":"1014"}},"id":"1013","type":"LinearAxis"},{"attributes":{"line_cap":"round","line_color":"#FC9366","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1050","type":"Line"},{"attributes":{"source":{"id":"1064"}},"id":"1069","type":"CDSView"},{"attributes":{},"id":"1118","type":"Selection"},{"attributes":{},"id":"1009","type":"LinearScale"},{"attributes":{},"id":"1018","type":"BasicTicker"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#430F75","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1067","type":"Line"},{"attributes":{"axis_label":"Proportion","formatter":{"id":"1043"},"ticker":{"id":"1018"}},"id":"1017","type":"LinearAxis"},{"attributes":{"callback":null},"id":"1102","type":"HoverTool"},{"attributes":{"click_policy":"mute","items":[{"id":"1048"},{"id":"1063"},{"id":"1080"},{"id":"1099"}]},"id":"1047","type":"Legend"},{"attributes":{"below":[{"id":"1013"}],"center":[{"id":"1016"},{"id":"1020"},{"id":"1047"}],"left":[{"id":"1017"}],"plot_height":400,"renderers":[{"id":"1039"},{"id":"1053"},{"id":"1068"},{"id":"1085"}],"title":{"id":"1003"},"toolbar":{"id":"1028"},"x_range":{"id":"1005"},"x_scale":{"id":"1009"},"y_range":{"id":"1007"},"y_scale":{"id":"1011"}},"id":"1002","subtype":"Figure","type":"Plot"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#F0605D","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1038","type":"Line"},{"attributes":{},"id":"1078","type":"Selection"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70],"y":[0.75,0.75,0.75,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666,0.6666666666666666]},"selected":{"id":"1078"},"selection_policy":{"id":"1079"}},"id":"1049","type":"ColumnDataSource"},{"attributes":{"fill_alpha":0.5,"fill_color":"lightgrey","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"xs_units":"screen","ys_units":"screen"},"id":"1111","type":"PolyAnnotation"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#FC9366","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1051","type":"Line"},{"attributes":{"bottom_units":"screen","fill_alpha":0.5,"fill_color":"lightgrey","left_units":"screen","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1027","type":"BoxAnnotation"},{"attributes":{"label":{"value":"False - C.T."},"renderers":[{"id":"1068"}]},"id":"1080","type":"LegendItem"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70],"y":[0.42857142857142855,0.42857142857142855,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714]},"selected":{"id":"1061"},"selection_policy":{"id":"1062"}},"id":"1035","type":"ColumnDataSource"},{"attributes":{},"id":"1079","type":"UnionRenderers"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1021"},{"id":"1022"},{"id":"1023"},{"id":"1024"},{"id":"1025"},{"id":"1026"},{"id":"1100"},{"id":"1102"}]},"id":"1028","type":"Toolbar"},{"attributes":{},"id":"1021","type":"PanTool"},{"attributes":{"overlay":{"id":"1111"}},"id":"1100","type":"LassoSelectTool"},{"attributes":{"line_cap":"round","line_color":"#711F81","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1082","type":"Line"},{"attributes":{},"id":"1005","type":"DataRange1d"},{"attributes":{"source":{"id":"1035"}},"id":"1040","type":"CDSView"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#711F81","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1083","type":"Line"},{"attributes":{},"id":"1022","type":"WheelZoomTool"},{"attributes":{"label":{"value":"True - C.T."},"renderers":[{"id":"1039"}]},"id":"1048","type":"LegendItem"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#F0605D","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1037","type":"Line"},{"attributes":{"line_cap":"round","line_color":"#430F75","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1065","type":"Line"},{"attributes":{"label":{"value":"False - E.B."},"renderers":[{"id":"1085"}]},"id":"1099","type":"LegendItem"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70],"y":[0.25,0.25,0.25,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333,0.3333333333333333]},"selected":{"id":"1118"},"selection_policy":{"id":"1119"}},"id":"1081","type":"ColumnDataSource"},{"attributes":{"overlay":{"id":"1027"}},"id":"1023","type":"BoxZoomTool"},{"attributes":{"source":{"id":"1049"}},"id":"1054","type":"CDSView"},{"attributes":{"text":"Hyper parameter search - Confusion parameters plot"},"id":"1003","type":"Title"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#FC9366","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1052","type":"Line"},{"attributes":{},"id":"1119","type":"UnionRenderers"},{"attributes":{"data_source":{"id":"1049"},"glyph":{"id":"1050"},"hover_glyph":null,"muted_glyph":{"id":"1052"},"nonselection_glyph":{"id":"1051"},"selection_glyph":null,"view":{"id":"1054"}},"id":"1053","type":"GlyphRenderer"},{"attributes":{},"id":"1024","type":"SaveTool"},{"attributes":{},"id":"1007","type":"DataRange1d"},{"attributes":{},"id":"1061","type":"Selection"},{"attributes":{},"id":"1025","type":"ResetTool"},{"attributes":{},"id":"1014","type":"BasicTicker"},{"attributes":{},"id":"1098","type":"UnionRenderers"},{"attributes":{"source":{"id":"1081"}},"id":"1086","type":"CDSView"},{"attributes":{"axis":{"id":"1013"},"band_fill_alpha":0.05,"band_fill_color":"#000003","grid_line_alpha":0,"ticker":null},"id":"1016","type":"Grid"},{"attributes":{"label":{"value":"True - E.B."},"renderers":[{"id":"1053"}]},"id":"1063","type":"LegendItem"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#711F81","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1084","type":"Line"},{"attributes":{"data_source":{"id":"1081"},"glyph":{"id":"1082"},"hover_glyph":null,"muted_glyph":{"id":"1084"},"nonselection_glyph":{"id":"1083"},"selection_glyph":null,"view":{"id":"1086"}},"id":"1085","type":"GlyphRenderer"},{"attributes":{},"id":"1026","type":"HelpTool"},{"attributes":{},"id":"1062","type":"UnionRenderers"},{"attributes":{"line_cap":"round","line_color":"#F0605D","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1036","type":"Line"},{"attributes":{},"id":"1097","type":"Selection"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70],"y":[0.5714285714285714,0.5714285714285714,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855]},"selected":{"id":"1097"},"selection_policy":{"id":"1098"}},"id":"1064","type":"ColumnDataSource"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#430F75","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1066","type":"Line"},{"attributes":{},"id":"1011","type":"LinearScale"},{"attributes":{},"id":"1045","type":"BasicTickFormatter"}],"root_ids":["1104"]},"title":"Bokeh Application","version":"2.0.1"}};
  var render_items = [{"docid":"fb2d6ddb-1655-47fe-b9ad-17989200d0e1","root_ids":["1104"],"roots":{"1104":"c6dbd94d-b5e2-4daf-92f4-741d8b9c3063"}}];
  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);

  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);
</script></div>
</div>
</div>
<div class="section" id="Train-model">
<h3>Train model<a class="headerlink" href="#Train-model" title="Permalink to this headline">¶</a></h3>
<p>After running the hyper parameter search we can create a model with the best defined hyper parameters, or setup parameters, and consolidate the model in to the best version for further performance analysis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;criterion&#39;</span> <span class="p">:</span> <span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="c1"># or &#39;entropy&#39; for information gain</span>
    <span class="s1">&#39;max_depth&#39;</span> <span class="p">:</span> <span class="n">max_depth</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Create the model classifier</span>
<span class="n">freq_clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param_dist</span><span class="p">)</span>

<span class="c1"># Train the model</span>
<span class="n">freq_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DecisionTreeClassifier(ccp_alpha=0.0, class_weight=None, criterion=&#39;entropy&#39;,
                       max_depth=3, max_features=None, max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, presort=&#39;deprecated&#39;,
                       random_state=0, splitter=&#39;best&#39;)
</pre></div></div>
</div>
</div>
<div class="section" id="Results">
<h3>Results<a class="headerlink" href="#Results" title="Permalink to this headline">¶</a></h3>
<p>In this part it is presented the results from the classification algorithm. Both regarding the data visualization and the model classification quality.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">plot_confusion_matrix</span>

<span class="n">disp</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">freq_clf</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span>
                             <span class="n">display_labels</span><span class="o">=</span><span class="n">le_freq</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span>
                             <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="n">disp</span><span class="o">.</span><span class="n">ax_</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Periodogram Classifier - Confusion matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03_-_Machine_Learning_-_Decision_Trees_16_0.png" src="_images/03_-_Machine_Learning_-_Decision_Trees_16_0.png" />
</div>
</div>
<div class="section" id="Comments">
<h4>Comments<a class="headerlink" href="#Comments" title="Permalink to this headline">¶</a></h4>
<p><em>From this result, it possible to see that the decision tree model is able to learn some information from eclipsing binaries, as it just get 25% of the testing data wrong. But when analysing the confirmed targets results, it is possible to see that we have a coin toss algorithm, since it cannot learn anything from the exo planets data. Comparing with the XGBoost algorithm it is possible to see a big downgrade on the classification results, ensuring the outstanding capability of the boosting
feature of the algorithm.</em></p>
</div>
</div>
</div>
<div class="section" id="Naive-Bayes-likelihood">
<h2>Naive Bayes likelihood<a class="headerlink" href="#Naive-Bayes-likelihood" title="Permalink to this headline">¶</a></h2>
<p>Here we will read the Naive Bayes model parameters estimated for each light curve and use this information as feature for the xgBoost classifier. To start this approach, we must first read the Bayes features saved from last step:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;./features/bayes_data/nx_12/bayes_data.pkl&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">bayes_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">bayes_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;features&#39;, &#39;labels&#39;])
</pre></div></div>
</div>
<div class="section" id="id1">
<h3>Manipulate features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>After reading the data, it is necessary to create the classical regression structure model in the format <span class="math notranslate nohighlight">\(Y = f\left(\Theta, X\right)\)</span>, normalize the feature data and encode any possible label data into numerical classes. This is just the preparation for the machine leaning algorithm to guarantee that the provided info is properlly designed for any machine learning classical form.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>

<span class="c1"># Create the label encoder</span>
<span class="n">le_bayes</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">le_bayes</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">bayes_data</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">])</span>

<span class="c1"># Define the regression model</span>
<span class="n">regressors</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">bayes_data</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="s1">&#39;params&#39;</span><span class="p">])</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">le_bayes</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">bayes_data</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h3>Train-test data split<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Next it is necessary to segregate the data into a set for validation and one for trainning the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">regressors</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Hyper tunning<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>We could consider tunning the model hyper parameters to answer questions such as:</p>
<ul class="simple">
<li><p>Wich value of <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code> is the best for this model and data?</p></li>
<li><p>Wich cost function is the best to be selected as <code class="docutils literal notranslate"><span class="pre">criterion</span></code> for this model?</p></li>
</ul>
<p>We could do a hyper search, to find the best hyper parameters for this model, automating the hyper parameter selection. There are several already builded algorithms to optimize this parameter search, and build find with high performance the best parameters, provided a set of possible values. But, to understand what those algorithms actually does, we could once build our own search algorithm…</p>
<p>As an example, lets run a first handly defined hyper parameter tunning using the confusion matrix of the model:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="c1"># Define the model parameters</span>
<span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;random_state&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;criterion&#39;</span> <span class="p">:</span> <span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="c1"># or &#39;entropy&#39; for information gain</span>
    <span class="s1">&#39;max_depth&#39;</span> <span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="c1"># Create the range parameters to</span>
<span class="c1"># search</span>
<span class="n">max_features_dim</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">max_depth</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_features_dim</span><span class="p">)]</span>

<span class="c1"># Create the plotting variable</span>
<span class="n">plot_vals</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;confirmed targets&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">},</span>
    <span class="s1">&#39;false&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;confirmed targets&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Estimate and validate each candidate</span>
<span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">max_depth</span><span class="p">:</span>
    <span class="c1"># Update the model parameters</span>
    <span class="n">param_dist</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt</span>
    <span class="c1"># Create the xgBoost classifier</span>
    <span class="n">clfs</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param_dist</span><span class="p">)</span>
    <span class="c1"># Fit the model to the data</span>
    <span class="n">clfs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1"># Estimate the test output</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">clfs</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="c1"># Compute the confusion matrix</span>
    <span class="n">conf_mat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span>
        <span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
    <span class="c1"># Save the confusion matrix</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Line plot each confidence matrix parameter</span>
<span class="n">x_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">]</span>
<span class="n">y_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">],</span>
          <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">],</span>
          <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">],</span>
          <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">]]</span>
<span class="n">legends</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;True - C.T.&#39;</span><span class="p">,</span> <span class="s1">&#39;True - E.B.&#39;</span><span class="p">,</span> <span class="s1">&#39;False - C.T.&#39;</span><span class="p">,</span> <span class="s1">&#39;False - E.B.&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">visual</span><span class="o">.</span><span class="n">multline_plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span>
                         <span class="n">legend_label</span><span class="o">=</span><span class="n">legends</span><span class="p">,</span>
                         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Hyper parameter search - Confusion parameters plot&#39;</span><span class="p">,</span>
                         <span class="n">color_index</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                         <span class="n">y_axis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Proportion&#39;</span><span class="p">},</span>
                         <span class="n">x_axis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">})</span>
<span class="n">visual</span><span class="o">.</span><span class="n">show_plot</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div class="bk-root" id="8954fd70-a0cb-4671-bf3b-f67f9bead538" data-root-id="1312"></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
(function(root) {
  function embed_document(root) {

  var docs_json = {"2624f532-ec12-4a8e-a06e-ced378dfa713":{"roots":{"references":[{"attributes":{"children":[{"id":"1210"}]},"id":"1312","type":"Column"},{"attributes":{"data_source":{"id":"1257"},"glyph":{"id":"1258"},"hover_glyph":null,"muted_glyph":{"id":"1260"},"nonselection_glyph":{"id":"1259"},"selection_glyph":null,"view":{"id":"1262"}},"id":"1261","type":"GlyphRenderer"},{"attributes":{},"id":"1230","type":"WheelZoomTool"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#F0605D","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1245","type":"Line"},{"attributes":{},"id":"1213","type":"DataRange1d"},{"attributes":{"source":{"id":"1243"}},"id":"1248","type":"CDSView"},{"attributes":{},"id":"1306","type":"UnionRenderers"},{"attributes":{"below":[{"id":"1221"}],"center":[{"id":"1224"},{"id":"1228"},{"id":"1255"}],"left":[{"id":"1225"}],"plot_height":400,"renderers":[{"id":"1247"},{"id":"1261"},{"id":"1276"},{"id":"1293"}],"title":{"id":"1211"},"toolbar":{"id":"1236"},"x_range":{"id":"1213"},"x_scale":{"id":"1217"},"y_range":{"id":"1215"},"y_scale":{"id":"1219"}},"id":"1210","subtype":"Figure","type":"Plot"},{"attributes":{"overlay":{"id":"1235"}},"id":"1231","type":"BoxZoomTool"},{"attributes":{},"id":"1217","type":"LinearScale"},{"attributes":{"data_source":{"id":"1272"},"glyph":{"id":"1273"},"hover_glyph":null,"muted_glyph":{"id":"1275"},"nonselection_glyph":{"id":"1274"},"selection_glyph":null,"view":{"id":"1277"}},"id":"1276","type":"GlyphRenderer"},{"attributes":{},"id":"1232","type":"SaveTool"},{"attributes":{},"id":"1219","type":"LinearScale"},{"attributes":{},"id":"1233","type":"ResetTool"},{"attributes":{},"id":"1226","type":"BasicTicker"},{"attributes":{"axis":{"id":"1221"},"band_fill_alpha":0.05,"band_fill_color":"#000003","grid_line_alpha":0,"ticker":null},"id":"1224","type":"Grid"},{"attributes":{"click_policy":"mute","items":[{"id":"1256"},{"id":"1271"},{"id":"1288"},{"id":"1307"}]},"id":"1255","type":"Legend"},{"attributes":{},"id":"1222","type":"BasicTicker"},{"attributes":{},"id":"1234","type":"HelpTool"},{"attributes":{"source":{"id":"1272"}},"id":"1277","type":"CDSView"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#430F75","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1275","type":"Line"},{"attributes":{"axis_label":"n_estimators","formatter":{"id":"1253"},"ticker":{"id":"1222"}},"id":"1221","type":"LinearAxis"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12],"y":[0.75,0.8333333333333334,0.8333333333333334,0.9166666666666666,0.8333333333333334,0.8333333333333334,0.8333333333333334,0.8333333333333334,0.8333333333333334,0.8333333333333334,0.8333333333333334,0.8333333333333334]},"selected":{"id":"1286"},"selection_policy":{"id":"1287"}},"id":"1257","type":"ColumnDataSource"},{"attributes":{},"id":"1215","type":"DataRange1d"},{"attributes":{"overlay":{"id":"1334"}},"id":"1308","type":"LassoSelectTool"},{"attributes":{"label":{"value":"False - C.T."},"renderers":[{"id":"1276"}]},"id":"1288","type":"LegendItem"},{"attributes":{"line_cap":"round","line_color":"#FC9366","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1258","type":"Line"},{"attributes":{},"id":"1269","type":"Selection"},{"attributes":{},"id":"1286","type":"Selection"},{"attributes":{},"id":"1287","type":"UnionRenderers"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12],"y":[0.35714285714285715,0.42857142857142855,0.35714285714285715,0.2857142857142857,0.2857142857142857,0.2857142857142857,0.2857142857142857,0.2857142857142857,0.2857142857142857,0.2857142857142857,0.2857142857142857,0.2857142857142857]},"selected":{"id":"1305"},"selection_policy":{"id":"1306"}},"id":"1272","type":"ColumnDataSource"},{"attributes":{"line_cap":"round","line_color":"#711F81","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1290","type":"Line"},{"attributes":{"label":{"value":"True - C.T."},"renderers":[{"id":"1247"}]},"id":"1256","type":"LegendItem"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#711F81","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1291","type":"Line"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1229"},{"id":"1230"},{"id":"1231"},{"id":"1232"},{"id":"1233"},{"id":"1234"},{"id":"1308"},{"id":"1310"}]},"id":"1236","type":"Toolbar"},{"attributes":{},"id":"1251","type":"BasicTickFormatter"},{"attributes":{},"id":"1270","type":"UnionRenderers"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#430F75","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1274","type":"Line"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12],"y":[0.25,0.16666666666666666,0.16666666666666666,0.08333333333333333,0.16666666666666666,0.16666666666666666,0.16666666666666666,0.16666666666666666,0.16666666666666666,0.16666666666666666,0.16666666666666666,0.16666666666666666]},"selected":{"id":"1341"},"selection_policy":{"id":"1342"}},"id":"1289","type":"ColumnDataSource"},{"attributes":{"fill_alpha":0.5,"fill_color":"lightgrey","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"xs_units":"screen","ys_units":"screen"},"id":"1334","type":"PolyAnnotation"},{"attributes":{"label":{"value":"True - E.B."},"renderers":[{"id":"1261"}]},"id":"1271","type":"LegendItem"},{"attributes":{"axis":{"id":"1225"},"dimension":1,"grid_line_alpha":0,"ticker":null},"id":"1228","type":"Grid"},{"attributes":{"axis_label":"Proportion","formatter":{"id":"1251"},"ticker":{"id":"1226"}},"id":"1225","type":"LinearAxis"},{"attributes":{"line_cap":"round","line_color":"#430F75","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1273","type":"Line"},{"attributes":{"label":{"value":"False - E.B."},"renderers":[{"id":"1293"}]},"id":"1307","type":"LegendItem"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#F0605D","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1246","type":"Line"},{"attributes":{},"id":"1253","type":"BasicTickFormatter"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12],"y":[0.6428571428571429,0.5714285714285714,0.6428571428571429,0.7142857142857143,0.7142857142857143,0.7142857142857143,0.7142857142857143,0.7142857142857143,0.7142857142857143,0.7142857142857143,0.7142857142857143,0.7142857142857143]},"selected":{"id":"1269"},"selection_policy":{"id":"1270"}},"id":"1243","type":"ColumnDataSource"},{"attributes":{"text":"Hyper parameter search - Confusion parameters plot"},"id":"1211","type":"Title"},{"attributes":{"line_cap":"round","line_color":"#F0605D","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1244","type":"Line"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#FC9366","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1260","type":"Line"},{"attributes":{"source":{"id":"1289"}},"id":"1294","type":"CDSView"},{"attributes":{"data_source":{"id":"1243"},"glyph":{"id":"1244"},"hover_glyph":null,"muted_glyph":{"id":"1246"},"nonselection_glyph":{"id":"1245"},"selection_glyph":null,"view":{"id":"1248"}},"id":"1247","type":"GlyphRenderer"},{"attributes":{"callback":null},"id":"1310","type":"HoverTool"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#FC9366","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1259","type":"Line"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#711F81","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1292","type":"Line"},{"attributes":{"data_source":{"id":"1289"},"glyph":{"id":"1290"},"hover_glyph":null,"muted_glyph":{"id":"1292"},"nonselection_glyph":{"id":"1291"},"selection_glyph":null,"view":{"id":"1294"}},"id":"1293","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1257"}},"id":"1262","type":"CDSView"},{"attributes":{"bottom_units":"screen","fill_alpha":0.5,"fill_color":"lightgrey","left_units":"screen","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1235","type":"BoxAnnotation"},{"attributes":{},"id":"1342","type":"UnionRenderers"},{"attributes":{},"id":"1229","type":"PanTool"},{"attributes":{},"id":"1305","type":"Selection"},{"attributes":{},"id":"1341","type":"Selection"}],"root_ids":["1312"]},"title":"Bokeh Application","version":"2.0.1"}};
  var render_items = [{"docid":"2624f532-ec12-4a8e-a06e-ced378dfa713","root_ids":["1312"],"roots":{"1312":"8954fd70-a0cb-4671-bf3b-f67f9bead538"}}];
  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);

  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);
</script></div>
</div>
</div>
<div class="section" id="id4">
<h3>Train model<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>After running the hyper parameter search we can create a model with the best defined hyper parameters, or setup parameters, and consolidate the model in to the best version for further performance analysis. The model is saved on a particular variable, such as <code class="docutils literal notranslate"><span class="pre">bayes_clf</span></code> to be further used in some vote chain model, if further necessary.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;criterion&#39;</span> <span class="p">:</span> <span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="c1"># or &#39;entropy&#39; for information gain</span>
    <span class="s1">&#39;max_depth&#39;</span> <span class="p">:</span> <span class="n">max_depth</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Create the model classifier</span>
<span class="n">bayes_clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param_dist</span><span class="p">)</span>

<span class="c1"># Train the model</span>
<span class="n">bayes_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DecisionTreeClassifier(ccp_alpha=0.0, class_weight=None, criterion=&#39;gini&#39;,
                       max_depth=4, max_features=None, max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, presort=&#39;deprecated&#39;,
                       random_state=0, splitter=&#39;best&#39;)
</pre></div></div>
</div>
</div>
<div class="section" id="id5">
<h3>Results<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>In this part it is presented the results from the classification algorithm. Both regarding the data visualization and the model classification quality.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">plot_confusion_matrix</span>

<span class="n">disp</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">bayes_clf</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span>
                             <span class="n">display_labels</span><span class="o">=</span><span class="n">le_bayes</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span>
                             <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="n">disp</span><span class="o">.</span><span class="n">ax_</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bayes Classifier - Confusion matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03_-_Machine_Learning_-_Decision_Trees_30_0.png" src="_images/03_-_Machine_Learning_-_Decision_Trees_30_0.png" />
</div>
</div>
<div class="section" id="id6">
<h4>Comments<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p><em>This one of the most interesting results… note that this same result appered on the XGBoost classifier algorithm. This enables the speculation that the Naive Bayes parameters provide an information so clean about the classes that any algorithm, as complex as possible, or as simple as possible, will be able to find a classification pattern. To examplify this assumption we can plot the tree such as:</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">p_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">plot_tree</span><span class="p">(</span><span class="n">bayes_clf</span><span class="p">,</span>
                        <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">rotate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">rounded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03_-_Machine_Learning_-_Decision_Trees_32_0.png" src="_images/03_-_Machine_Learning_-_Decision_Trees_32_0.png" />
</div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Hidden-Markov-Models">
<h2>Hidden Markov Models<a class="headerlink" href="#Hidden-Markov-Models" title="Permalink to this headline">¶</a></h2>
<p>Here we use the model estimated from the Hidden Markov Models library, wich is the estimated <span class="math notranslate nohighlight">\(A\)</span> matrix, or the so called transition probability matrices as feature for the learning classifier. For that we must read the pickle file with the desired features:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;./features/hmm_data/nx_20/hmm_data.pkl&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">hmm_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">hmm_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;y&#39;, &#39;t&#39;, &#39;labels&#39;, &#39;features&#39;])
</pre></div></div>
</div>
<div class="section" id="id7">
<h3>Manipulate features<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>After reading the data, it is necessary to create the classical regression structure model in the format <span class="math notranslate nohighlight">\(Y = f\left(\Theta, X\right)\)</span>, normalize the feature data and encode any possible label data into numerical classes. This is just the preparation for the machine leaning algorithm to guarantee that the provided info is properlly designed for any machine learning classical form.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>

<span class="c1"># Encode the label</span>
<span class="n">le_hmm</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">le_hmm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">hmm_data</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="p">)</span>

<span class="c1"># Define the model order</span>
<span class="n">feat</span> <span class="o">=</span> <span class="n">hmm_data</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]</span>
<span class="n">nx</span> <span class="o">=</span> <span class="n">feat</span><span class="p">[</span><span class="s1">&#39;prob_matrix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">regressors</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">feat</span><span class="p">[</span><span class="s1">&#39;prob_matrix&#39;</span><span class="p">]:</span>
    <span class="c1"># Reshape the regressor</span>
    <span class="n">reg</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nx</span><span class="o">*</span><span class="n">nx</span><span class="p">)</span>
    <span class="c1"># Add to the regressors</span>
    <span class="n">regressors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
<span class="c1"># Normalize the regressors</span>
<span class="n">regressors</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">regressors</span><span class="p">)</span>
<span class="c1"># Define outputs as encoded variables</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">le_hmm</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">hmm_data</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id8">
<h3>Train-test data split<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Next it is necessary to segregate the data into a set for validation and one for trainning the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">regressors</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id9">
<h3>Hyper tunning<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>We could consider tunning the model hyper parameters to answer questions such as:</p>
<ul class="simple">
<li><p>Wich value of <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code> is the best for this model and data?</p></li>
<li><p>Wich cost function is the best to be selected as <code class="docutils literal notranslate"><span class="pre">objective</span></code> for this model?</p></li>
</ul>
<p>We could do a hyper search, to find the best hyper parameters for this model, automating the hyper parameter selection. There are several already builded algorithms to optimize this parameter search, and build find with high performance the best parameters, provided a set of possible values. But, to understand what those algorithms actually does, we could once build our own search algorithm…</p>
<p>As an example, lets run a first handly defined hyper parameter tunning using the confusion matrix of the model:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="c1"># Define the model parameters</span>
<span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;random_state&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;criterion&#39;</span> <span class="p">:</span> <span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="c1"># or &#39;entropy&#39; for information gain</span>
    <span class="s1">&#39;max_depth&#39;</span> <span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="c1"># Create the range parameters to</span>
<span class="c1"># search</span>
<span class="n">max_features_dim</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">max_depth</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_features_dim</span><span class="p">)]</span>

<span class="c1"># Create the plotting variable</span>
<span class="n">plot_vals</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;confirmed targets&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">},</span>
    <span class="s1">&#39;false&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;confirmed targets&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Estimate and validate each candidate</span>
<span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">max_depth</span><span class="p">:</span>
    <span class="c1"># Update the model parameters</span>
    <span class="n">param_dist</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt</span>
    <span class="c1"># Create the xgBoost classifier</span>
    <span class="n">clfs</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param_dist</span><span class="p">)</span>
    <span class="c1"># Fit the model to the data</span>
    <span class="n">clfs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="c1"># Estimate the test output</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">clfs</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="c1"># Compute the confusion matrix</span>
    <span class="n">conf_mat</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span>
        <span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span>
        <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
    <span class="c1"># Save the confusion matrix</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conf_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Line plot each confidence matrix parameter</span>
<span class="n">x_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">max_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">]</span>
<span class="n">y_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">],</span>
          <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">],</span>
          <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;confirmed targets&#39;</span><span class="p">],</span>
          <span class="n">plot_vals</span><span class="p">[</span><span class="s1">&#39;false&#39;</span><span class="p">][</span><span class="s1">&#39;eclipsing binaries&#39;</span><span class="p">]]</span>
<span class="n">legends</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;True - C.T.&#39;</span><span class="p">,</span> <span class="s1">&#39;True - E.B.&#39;</span><span class="p">,</span> <span class="s1">&#39;False - C.T.&#39;</span><span class="p">,</span> <span class="s1">&#39;False - E.B.&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">visual</span><span class="o">.</span><span class="n">multline_plot</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span>
                         <span class="n">legend_label</span><span class="o">=</span><span class="n">legends</span><span class="p">,</span>
                         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Hyper parameter search - Confusion parameters plot&#39;</span><span class="p">,</span>
                         <span class="n">color_index</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                         <span class="n">y_axis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Proportion&#39;</span><span class="p">},</span>
                         <span class="n">x_axis</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">})</span>
<span class="n">visual</span><span class="o">.</span><span class="n">show_plot</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div class="bk-root" id="98b76ac7-8e92-4ec8-978f-c1acce811365" data-root-id="1535"></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
(function(root) {
  function embed_document(root) {

  var docs_json = {"d3cc03b4-7cbd-4c0d-8454-26595e772206":{"roots":{"references":[{"attributes":{"children":[{"id":"1433"}]},"id":"1535","type":"Column"},{"attributes":{},"id":"1442","type":"LinearScale"},{"attributes":{"below":[{"id":"1444"}],"center":[{"id":"1447"},{"id":"1451"},{"id":"1478"}],"left":[{"id":"1448"}],"plot_height":400,"renderers":[{"id":"1470"},{"id":"1484"},{"id":"1499"},{"id":"1516"}],"title":{"id":"1434"},"toolbar":{"id":"1459"},"x_range":{"id":"1436"},"x_scale":{"id":"1440"},"y_range":{"id":"1438"},"y_scale":{"id":"1442"}},"id":"1433","subtype":"Figure","type":"Plot"},{"attributes":{"overlay":{"id":"1458"}},"id":"1454","type":"BoxZoomTool"},{"attributes":{},"id":"1438","type":"DataRange1d"},{"attributes":{},"id":"1455","type":"SaveTool"},{"attributes":{"label":{"value":"True - E.B."},"renderers":[{"id":"1484"}]},"id":"1494","type":"LegendItem"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#430F75","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1497","type":"Line"},{"attributes":{"data_source":{"id":"1466"},"glyph":{"id":"1467"},"hover_glyph":null,"muted_glyph":{"id":"1469"},"nonselection_glyph":{"id":"1468"},"selection_glyph":null,"view":{"id":"1471"}},"id":"1470","type":"GlyphRenderer"},{"attributes":{"fill_alpha":0.5,"fill_color":"lightgrey","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"xs_units":"screen","ys_units":"screen"},"id":"1572","type":"PolyAnnotation"},{"attributes":{},"id":"1493","type":"UnionRenderers"},{"attributes":{},"id":"1440","type":"LinearScale"},{"attributes":{},"id":"1456","type":"ResetTool"},{"attributes":{},"id":"1492","type":"Selection"},{"attributes":{"label":{"value":"False - C.T."},"renderers":[{"id":"1499"}]},"id":"1511","type":"LegendItem"},{"attributes":{"source":{"id":"1466"}},"id":"1471","type":"CDSView"},{"attributes":{},"id":"1580","type":"UnionRenderers"},{"attributes":{},"id":"1457","type":"HelpTool"},{"attributes":{"callback":null},"id":"1533","type":"HoverTool"},{"attributes":{"source":{"id":"1480"}},"id":"1485","type":"CDSView"},{"attributes":{},"id":"1510","type":"UnionRenderers"},{"attributes":{"axis_label":"Proportion","formatter":{"id":"1474"},"ticker":{"id":"1449"}},"id":"1448","type":"LinearAxis"},{"attributes":{"axis_label":"n_estimators","formatter":{"id":"1476"},"ticker":{"id":"1445"}},"id":"1444","type":"LinearAxis"},{"attributes":{},"id":"1449","type":"BasicTicker"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400],"y":[0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75]},"selected":{"id":"1509"},"selection_policy":{"id":"1510"}},"id":"1480","type":"ColumnDataSource"},{"attributes":{"data_source":{"id":"1480"},"glyph":{"id":"1481"},"hover_glyph":null,"muted_glyph":{"id":"1483"},"nonselection_glyph":{"id":"1482"},"selection_glyph":null,"view":{"id":"1485"}},"id":"1484","type":"GlyphRenderer"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#FC9366","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1483","type":"Line"},{"attributes":{"line_cap":"round","line_color":"#711F81","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1513","type":"Line"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#711F81","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1514","type":"Line"},{"attributes":{},"id":"1509","type":"Selection"},{"attributes":{},"id":"1529","type":"UnionRenderers"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400],"y":[0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25]},"selected":{"id":"1579"},"selection_policy":{"id":"1580"}},"id":"1512","type":"ColumnDataSource"},{"attributes":{},"id":"1528","type":"Selection"},{"attributes":{"click_policy":"mute","items":[{"id":"1479"},{"id":"1494"},{"id":"1511"},{"id":"1530"}]},"id":"1478","type":"Legend"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400],"y":[0.2857142857142857,0.5714285714285714,0.42857142857142855,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714,0.5714285714285714]},"selected":{"id":"1528"},"selection_policy":{"id":"1529"}},"id":"1495","type":"ColumnDataSource"},{"attributes":{},"id":"1445","type":"BasicTicker"},{"attributes":{},"id":"1474","type":"BasicTickFormatter"},{"attributes":{"axis":{"id":"1444"},"band_fill_alpha":0.05,"band_fill_color":"#000003","grid_line_alpha":0,"ticker":null},"id":"1447","type":"Grid"},{"attributes":{},"id":"1436","type":"DataRange1d"},{"attributes":{"source":{"id":"1495"}},"id":"1500","type":"CDSView"},{"attributes":{"label":{"value":"True - C.T."},"renderers":[{"id":"1470"}]},"id":"1479","type":"LegendItem"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#430F75","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1498","type":"Line"},{"attributes":{"data":{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,334,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400],"y":[0.7142857142857143,0.42857142857142855,0.5714285714285714,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855,0.42857142857142855]},"selected":{"id":"1492"},"selection_policy":{"id":"1493"}},"id":"1466","type":"ColumnDataSource"},{"attributes":{"source":{"id":"1512"}},"id":"1517","type":"CDSView"},{"attributes":{},"id":"1579","type":"Selection"},{"attributes":{"axis":{"id":"1448"},"dimension":1,"grid_line_alpha":0,"ticker":null},"id":"1451","type":"Grid"},{"attributes":{},"id":"1476","type":"BasicTickFormatter"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#711F81","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1515","type":"Line"},{"attributes":{"data_source":{"id":"1495"},"glyph":{"id":"1496"},"hover_glyph":null,"muted_glyph":{"id":"1498"},"nonselection_glyph":{"id":"1497"},"selection_glyph":null,"view":{"id":"1500"}},"id":"1499","type":"GlyphRenderer"},{"attributes":{"data_source":{"id":"1512"},"glyph":{"id":"1513"},"hover_glyph":null,"muted_glyph":{"id":"1515"},"nonselection_glyph":{"id":"1514"},"selection_glyph":null,"view":{"id":"1517"}},"id":"1516","type":"GlyphRenderer"},{"attributes":{"line_cap":"round","line_color":"#F0605D","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1467","type":"Line"},{"attributes":{"line_cap":"round","line_color":"#FC9366","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1481","type":"Line"},{"attributes":{"line_cap":"round","line_color":"#430F75","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1496","type":"Line"},{"attributes":{"text":"Hyper parameter search - Confusion parameters plot"},"id":"1434","type":"Title"},{"attributes":{"label":{"value":"False - E.B."},"renderers":[{"id":"1516"}]},"id":"1530","type":"LegendItem"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#F0605D","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1468","type":"Line"},{"attributes":{"bottom_units":"screen","fill_alpha":0.5,"fill_color":"lightgrey","left_units":"screen","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"render_mode":"css","right_units":"screen","top_units":"screen"},"id":"1458","type":"BoxAnnotation"},{"attributes":{"overlay":{"id":"1572"}},"id":"1531","type":"LassoSelectTool"},{"attributes":{"line_alpha":0.2,"line_cap":"round","line_color":"#F0605D","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1469","type":"Line"},{"attributes":{"line_alpha":0.1,"line_cap":"round","line_color":"#FC9366","line_width":3,"x":{"field":"x"},"y":{"field":"y"}},"id":"1482","type":"Line"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1452"},{"id":"1453"},{"id":"1454"},{"id":"1455"},{"id":"1456"},{"id":"1457"},{"id":"1531"},{"id":"1533"}]},"id":"1459","type":"Toolbar"},{"attributes":{},"id":"1452","type":"PanTool"},{"attributes":{},"id":"1453","type":"WheelZoomTool"}],"root_ids":["1535"]},"title":"Bokeh Application","version":"2.0.1"}};
  var render_items = [{"docid":"d3cc03b4-7cbd-4c0d-8454-26595e772206","root_ids":["1535"],"roots":{"1535":"98b76ac7-8e92-4ec8-978f-c1acce811365"}}];
  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);

  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);
</script></div>
</div>
</div>
<div class="section" id="id10">
<h3>Train model<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>After running the hyper parameter search we can create a model with the best defined hyper parameters, or setup parameters, and consolidate the model in to the best version for further performance analysis. The model is saved on a particular variable, such as <code class="docutils literal notranslate"><span class="pre">hmm_clf</span></code> to be further used in some vote chain model, if further necessary.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;criterion&#39;</span> <span class="p">:</span> <span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="c1"># or &#39;entropy&#39; for information gain</span>
    <span class="s1">&#39;max_depth&#39;</span> <span class="p">:</span> <span class="n">max_depth</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Create the model classifier</span>
<span class="n">hmm_clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="o">**</span><span class="n">param_dist</span><span class="p">)</span>

<span class="c1"># Train the model</span>
<span class="n">hmm_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DecisionTreeClassifier(ccp_alpha=0.0, class_weight=None, criterion=&#39;gini&#39;,
                       max_depth=1, max_features=None, max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, presort=&#39;deprecated&#39;,
                       random_state=0, splitter=&#39;best&#39;)
</pre></div></div>
</div>
</div>
<div class="section" id="id11">
<h3>Results<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Here we include some visualization results for the xgBoost algorithm classification. As the first result, we just print the model eval metrics, here the <em>log loss</em> of the model, for both the trainning and testing data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">plot_confusion_matrix</span>

<span class="n">disp</span> <span class="o">=</span> <span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">hmm_clf</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span>
                             <span class="n">display_labels</span><span class="o">=</span><span class="n">le_hmm</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span>
                             <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span>
<span class="n">disp</span><span class="o">.</span><span class="n">ax_</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Confusion matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03_-_Machine_Learning_-_Decision_Trees_45_0.png" src="_images/03_-_Machine_Learning_-_Decision_Trees_45_0.png" />
</div>
</div>
<div class="section" id="id12">
<h4>Comments<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p><em>Note that here, the same happened with the XGBoost classifier… so the conclusion must be the same as the presented one from the Naive Bayes method. The information from the Hidden Markov Models, only contain so much information that only allows the classifier to get to this performance. This is shown by the best complexity found for this algorithm, which is :math:`n_x=1`, therefore the simplest model as possible. To illustrate that, we can show the tree such as:</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">p_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">plot_tree</span><span class="p">(</span><span class="n">hmm_clf</span><span class="p">,</span>
                        <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">proportion</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">rotate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">rounded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03_-_Machine_Learning_-_Decision_Trees_47_0.png" src="_images/03_-_Machine_Learning_-_Decision_Trees_47_0.png" />
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="modules.html" class="btn btn-neutral float-right" title="CoRoTContributions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="03 - Machine Learning - XGBoost Classifier.html" class="btn btn-neutral float-left" title="XGBoost Classifier" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Marcelo Lima

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>